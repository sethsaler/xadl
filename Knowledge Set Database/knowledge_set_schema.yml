schema:
  type: object
  required:
    - input
    - actions
    - functions
  properties:
    input:
      type: object
      required:
        - documents
        - workspace
      properties:
        documents:
          type: object
          required:
            - type
          properties:
            type:
              type: string
              enum: [document]
        workspace:
          type: object
          required:
            - type
          properties:
            type:
              type: string
              enum: [workspace]
              
    actions:
      type: object
      patternProperties:
        ^get-.*-tags$:
          type: object
          required:
            - tool
          properties:
            tool:
              type: string
              enum: [find-tags]
            name:
              type: array
              items:
                type: string
            category:
              type: string
              
        ^(base|analysis)Prompt$:
          type: object
          required:
            - tool
            - message
          properties:
            tool:
              type: string
              enum: [echo]
            message:
              type: string
              
        ^init-kset$:
          type: object
          required:
            - input
            - tool
            - knowledgeSetName
            - operations
          properties:
            input:
              type: object
              required:
                - documents
              patternProperties:
                ^.*Tags$:
                  type: string
            tool:
              type: string
              enum: [knowledge-set]
            knowledgeSetName:
              type: string
            operations:
              type: array
              items:
                type: object
                required:
                  - op
                properties:
                  op:
                    type: string
                    enum: [add-dimension, set-nodes]
                  key:
                    type: string
                  name:
                    type: string
                  nodes:
                    type: string
                  priority:
                    type: integer
                    minimum: 1
                    
        ^analyze-.*$:
          type: object
          required:
            - repeat
            - input
          properties:
            repeat:
              type: object
              required:
                - function
                - for
              properties:
                function:
                  type: string
                for:
                  type: array
                  items:
                    type: string
            input:
              type: object
              required:
                - tag
                - documents
                - knowledge
                - basePrompt
                - prompt
                - title
              properties:
                tag:
                  type: string
                documents:
                  type: string
                knowledge:
                  type: string
                basePrompt:
                  type: string
                prompt:
                  type: string
                title:
                  type: string
                  
    functions:
      type: object
      patternProperties:
        ^analyze-for-tag$:
          type: object
          required:
            - input
            - actions
          properties:
            input:
              type: object
              patternProperties:
                ^.*$:
                  type: object
                  required:
                    - type
                  properties:
                    type:
                      type: string
                      enum: [tag, document, text, knowledge-set]
            actions:
              type: object
              required:
                - get-snippets
                - get-instruction-prompt-for-tag
                - analyze-content
                - create-insight
              properties:
                get-snippets:
                  type: object
                  required:
                    - input
                    - tool
                    - textFilter
                  properties:
                    input:
                      type: object
                    tool:
                      type: string
                      enum: [document-text]
                    textFilter:
                      type: object
                get-instruction-prompt-for-tag:
                  type: object
                  required:
                    - input
                    - tool
                    - message
                  properties:
                    tool:
                      type: string
                      enum: [echo]
                analyze-content:
                  type: object
                  required:
                    - input
                    - tool
                    - skipIfEmpty
                    - prompt
                  properties:
                    tool:
                      type: string
                      enum: [llm]
                create-insight:
                  type: object
                  required:
                    - input
                    - tool
                    - text
                    - name
                    - tags
                    - attributes
                  properties:
                    tool:
                      type: string
                      enum: [insight]
